# Create an updated `index.html` that wires up PayPal (PayPal.me or Smart Buttons), Stripe Payment Links
# (card + Apple Pay), and SEPA (Echtzeit√ºberweisung/√úberweisung) with EPC QR, plus Cash. 
# All configurable via a CONFIG block at the top of the script.

from pathlib import Path

html = r"""<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Zenty Express AI ‚Äî Mobility & Transport</title>
<meta name="description" content="Zenty Express AI ¬∑ Mobility & Transport ¬∑ VIP Shuttle ¬∑ Kurier ¬∑ Intelligente Routen ¬∑ Made in Germany">

<!-- Leaflet (Map + Satellite Toggle) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

<!-- QR Code generator for EPC QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<style>
:root{
  --bg:#0b0f16; --panel:#111725; --border:#232b3e; --text:#eef3ff; --muted:#bfc8dc;
  --accent:#2aa8ff; --gold:#d4af37; --radius:22px; --shadow:0 12px 28px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{margin:0;background:radial-gradient(1200px 700px at 70% -10%,#182133 0%, transparent 55%), linear-gradient(180deg,#0b0f16,#0c1018);color:var(--text);font:16px/1.6 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:28px}

/* Header */
header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(10,14,22,.9),rgba(10,14,22,.25));backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
.nav{display:flex;align-items:center;gap:18px;padding:10px 18px}
.brand{display:flex;align-items:center;gap:12px}
.brand img{height:118px;width:auto;filter:drop-shadow(0 12px 24px rgba(0,0,0,.55))}
.brand strong{font-weight:800;color:#ffffff;font-size:18px;text-shadow:0 2px 6px rgba(0,0,0,.3)}
.spacer{flex:1}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:999px;border:1px solid #273148;background:linear-gradient(180deg,#141b2a,#0e1320);box-shadow:var(--shadow);cursor:pointer}
.btn:hover{transform:translateY(-1px)}
.btn.gold{background:linear-gradient(180deg,#2a2311,#171108);border-color:#3a2c09;color:#fbf6e5}

/* Headings */
h1{margin:10px 0 12px;font-weight:900;letter-spacing:.2px;font-size:clamp(32px,3.6vw,48px);text-shadow:0 3px 14px rgba(0,0,0,.35)}
h2{font-size:clamp(22px,2.2vw,30px);margin:0 0 14px;font-weight:900;color:#fff;text-shadow:0 3px 12px rgba(0,0,0,.5)}
h2::after{content:"";display:block;width:90px;height:3px;margin-top:8px;background:linear-gradient(90deg,#2aa8ff,#6fd0ff);border-radius:999px;opacity:.9}

/* Sections */
.section{padding:28px 18px}
.card{background:linear-gradient(180deg,#121a2a,#0c111c);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.card.pad{padding:28px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.hero{display:grid;grid-template-columns:1.2fr 1fr;gap:28px;align-items:center;padding:36px 18px 12px}
.muted{color:var(--muted)}
@media(max-width:1000px){.hero{grid-template-columns:1fr}.grid-4{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(2,1fr)}}

/* Tiles */
.tile{position:relative}
.tile img{width:100%;height:auto;display:block}
.tile .body{padding:14px}
.veh img{aspect-ratio:4/3;object-fit:cover;max-height:180px}
.veh .overlay{position:absolute;inset:auto 10px 10px auto;width:94px;opacity:.95;filter:drop-shadow(0 4px 10px rgba(0,0,0,.6))}
.pill{display:inline-block;border:1px solid #2b3143;border-radius:999px;padding:2px 8px;margin-left:8px;color:#b9c3d6;font-size:12px}

/* Map area */
.aiRoute{display:grid;grid-template-columns:1.1fr 1fr;gap:18px}
.canvasWrap{position:relative;height:420px;border-radius:var(--radius);border:1px solid var(--border);overflow:hidden;background:radial-gradient(600px 260px at 60% -10%, rgba(42,168,255,.18), transparent 60%), #0a0f17}
#starfield{position:absolute;inset:0;width:100%;height:100%}
.mapWrap{position:relative;border-radius:var(--radius);border:1px solid var(--border);padding:14px;background:linear-gradient(180deg,#0e1422,#0b101a)}
#map{height:320px;border-radius:14px;border:1px solid #253251;overflow:hidden}
.controls{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.input{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#0e1422;color:var(--text)}
.infoRow{display:flex;gap:10px;margin-top:8px;align-items:center;flex-wrap:wrap}
.stat{background:#0e1422;border:1px solid #28324a;border-radius:12px;padding:8px 10px}
footer{padding:28px;border-top:1px solid var(--border);color:#acb6c9}
.addr{margin-top:6px;color:#cdd7e9}

/* Modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);z-index:999}
.modal.open{display:flex}
.modal-card{width:min(720px,92vw);background:linear-gradient(180deg,#121a2a,#0d1320);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:18px}
.modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.close{background:transparent;border:0;color:#c9d3e8;font-size:20px;cursor:pointer}
.form{display:grid;gap:10px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
label.small{font-size:12px;color:#b9c6e2}
select, input[type="text"], input[type="datetime-local"], input[type="tel"], textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#0e1422;color:var(--text)}
textarea{min-height:70px;resize:vertical}
.pay-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.pay-opt{display:flex;gap:8px;align-items:center;border:1px solid #28324a;border-radius:12px;padding:10px;background:#0f1626;cursor:pointer}
.pay-opt input{accent-color:#2aa8ff}
.pay-panel{margin-top:8px;border:1px dashed #30405f;border-radius:12px;padding:10px;display:none}
.pay-panel.show{display:block}
.kv{display:grid;grid-template-columns:auto 1fr;gap:6px 10px}
.kv b{color:#eef3ff}
.code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0b1220; border:1px solid #28324a; padding:6px 8px; border-radius:8px}
.qrWrap{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.copyBtn{padding:6px 10px;border-radius:10px;border:1px solid #2d3b57;background:#0e1626;color:#cfe1ff;cursor:pointer}
</style>
</head>
<body>
<header>
  <div class="nav container">
    <a class="brand" href="#top"><img src="assets/logo.png" alt="Zenty Express AI"><strong>Zenty Express AI ¬∑ Mobility & Transport</strong></a>
    <div class="spacer"></div>
    <a class="btn" href="#fahrzeuge">Fahrzeuge</a>
    <a class="btn" href="#preise">Preise</a>
    <a class="btn" href="#ki">KI-System</a>
    <a class="btn gold" href="#kontakt">Kontakt</a>
  </div>
</header>

<section class="hero container">
  <div class="card pad">
    <h1>AI Powered Mobility ‚Äî Premium Shuttle ¬∑ Kurier ¬∑ Fleet</h1>
    <p class="muted">Intelligente Routen, Echtzeit-Analyse, zuverl√§ssige Transporte. <b>Zenty Express AI</b> setzt neue Ma√üst√§be in Mobilit√§t & Transport.</p>
    <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
      <a class="btn" href="#preise">üìÑ Preise ansehen</a>
      <a class="btn" href="#fahrzeuge">üöê Fahrzeugflotte</a>
    </div>
  </div>
  <div class="card" style="padding:0"><img src="assets/prospekt-cover-fleet.jpg" alt="Fleet Cover" style="width:100%;height:100%;object-fit:cover"></div>
</section>

<section class="section container">
  <h2>Unsere Leistungen</h2>
  <p class="muted">VIP Shuttle ¬∑ Kurier ¬∑ Flughafentransfer ¬∑ KI-gest√ºtzte Streckenoptimierung</p>
  <div class="grid-4">
    <article class="card tile"><img src="assets/prospekt-leistungen.jpg" alt=""><div class="body"><h3>VIP & Business</h3><p class="muted">Diskreter Fahrservice mit h√∂chstem Komfort.</p></div></article>
    <article class="card tile"><img src="assets/prospekt-ai-system.jpg" alt=""><div class="body"><h3>Shuttle & Gruppen</h3><p class="muted">Flughafen, Mitarbeiter, Events ‚Äî sicher & p√ºnktlich.</p></div></article>
    <article class="card tile"><img src="assets/prospekt-route-clean.jpg" alt=""><div class="body"><h3>Kurier & Express</h3><p class="muted">Zeitkritische Zustellung, europaweit 24/7.</p></div></article>
    <article class="card tile"><img src="assets/prospekt-ueber-uns.jpg" alt=""><div class="body"><h3>Fest- & Tagestouren</h3><p class="muted">Smart geplant mit KI, flexibel & transparent.</p></div></article>
  </div>
</section>

<section class="section container" id="fahrzeuge">
  <h2>Unsere Fahrzeugflotte</h2>
  <p class="muted">Schwarzer Vito & Caddy ¬∑ Wei√üe Trafic, Sprinter & Ducato ‚Äî gepflegt, bereit.</p>
  <div class="grid-4">
    <article class="card tile veh"><img src="assets/vito.jpg" alt="Mercedes Vito"><img class="overlay" src="assets/logo.png" alt=""><div class="body"><h3>Mercedes Vito <span class="pill">schwarz</span></h3><p class="muted">Eleganter Shuttle, bis 8 Personen.</p></div></article>
    <article class="card tile veh"><img src="assets/caddy.jpg" alt="VW Caddy"><img class="overlay" src="assets/logo.png" alt=""><div class="body"><h3>VW Caddy <span class="pill">schwarz</span></h3><p class="muted">Kompakt & wendig.</p></div></article>
    <article class="card tile veh"><img src="assets/trafic.jpg" alt="Renault Trafic"><img class="overlay" src="assets/logo.png" alt=""><div class="body"><h3>Renault Trafic <span class="pill">wei√ü</span></h3><p class="muted">Viel Platz f√ºr Team & Gep√§ck.</p></div></article>
    <article class="card tile veh"><img src="assets/sprinter.jpg" alt="Mercedes Sprinter"><img class="overlay" src="assets/logo.png" alt=""><div class="body"><h3>Mercedes Sprinter <span class="pill">wei√ü</span></h3><p class="muted">Gruppen- & Sondertransporte.</p></div></article>
  </div>
</section>

<section class="section container" id="preise">
  <h2>Preise</h2>
  <div class="grid-3">
    <article class="card pad"><h3>Basic</h3><p><b>‚Ç¨ 1,00/km</b></p><p class="muted">Kurzstrecken ¬∑ Transparente Tarife</p></article>
    <article class="card pad"><h3>Standard</h3><p><b>‚Ç¨ 0,90/km</b></p><p class="muted">20‚Äì100 km ¬∑ schnelle Verf√ºgbarkeit</p></article>
    <article class="card pad"><h3>Premium</h3><p><b>‚Ç¨ 0,80/km</b></p><p class="muted">Langstrecke ¬∑ VIP</p></article>
  </div>
  <p class="muted" style="margin-top:8px">Preise sind Richtwerte; Endpreise je nach Route & Zeitplan.</p>
</section>

<section class="section container" id="ki">
  <h2>Zenty AI Route Intelligence</h2>
  <div class="aiRoute">
    <div class="canvasWrap card"><canvas id="starfield"></canvas></div>
    <div class="mapWrap card">
      <h3>Ulm-Region ¬∑ 50‚Äâkm ¬∑ Start: <b>Lonsee</b></h3>
      <div id="map"></div>
      <div class="controls">
        <label>Start <input id="startInput" class="input" list="citylist" value="Lonsee"></label>
        <label>Ziel <input id="destInput" class="input" list="citylist" placeholder="Ziel w√§hlen‚Ä¶"></label>
        <datalist id="citylist"></datalist>
      </div>
      <div class="infoRow">
        <button class="btn" id="calcBtn">Preis berechnen</button>
        <button class="btn gold" id="bookBtn" disabled>Jetzt buchen</button>
        <div id="priceBox" class="stat">Entfernung: ‚Äî km ¬∑ Preis: ‚Äî</div>
      </div>
      <small class="muted">Tipp: Haritadaki i≈üaretlere tƒ±klayarak da hedefi se√ßebilirsin. ‚ÄúHarita/Sat‚Äù ile g√∂r√ºn√ºm√º deƒüi≈ütir.</small>
    </div>
  </div>
</section>

<section class="section container" id="kontakt">
  <h2>Kontakt & Standort</h2>
  <p class="muted">E-Mail: info@zentyexpress.de ¬∑ Web: zentyexpress.de</p>
  <p class="addr">Sitz: <b>Sinabronner Str. 25, 89173 Lonsee</b> ¬∑ Deutschland</p>
  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
    <a class="btn" id="waBtn" href="https://api.whatsapp.com/send?phone=49162575957" target="_blank" rel="noopener">WhatsApp</a>
    <a class="btn" href="https://t.me/ZentyExpressBot" target="_blank" rel="noopener">Telegram</a>
    <a class="btn gold" href="mailto:info@zentyexpress.de">E-Mail</a>
  </div>
</section>

<footer class="container">¬© Zenty Express AI ‚Äî Mobility & Transport ¬∑ Final Signature Edition v12 ¬∑ Made in Germany</footer>

<!-- Booking Modal -->
<div class="modal" id="payModal" aria-hidden="true" role="dialog" aria-labelledby="payTitle">
  <div class="modal-card">
    <div class="modal-head">
      <h3 id="payTitle">Buchung & Zahlung</h3>
      <button class="close" id="closeModal" aria-label="Close">√ó</button>
    </div>
    <form class="form" id="payForm" onsubmit="return false;">
      <div class="row">
        <label class="small">Name
          <input type="text" id="custName" placeholder="Ad Soyad / Name" required>
        </label>
        <label class="small">Telefon
          <input type="tel" id="custPhone" placeholder="+49 ..." required>
        </label>
      </div>
      <div class="row">
        <label class="small">Abholung / Pickup
          <input type="datetime-local" id="pickupTime" required>
        </label>
        <label class="small">Notiz (optional)
          <input type="text" id="note" placeholder="Gep√§ck, Personenanzahl, Flugnummer ‚Ä¶">
        </label>
      </div>
      <label class="small">Zahlungsart</label>
      <div class="pay-grid" id="payOptions">
        <label class="pay-opt"><input type="radio" name="pay" value="PayPal" required> PayPal</label>
        <label class="pay-opt"><input type="radio" name="pay" value="Apple Pay"> Apple&nbsp;Pay</label>
        <label class="pay-opt"><input type="radio" name="pay" value="Kreditkarte"> Kreditkarte</label>
        <label class="pay-opt"><input type="radio" name="pay" value="Echtzeit√ºberweisung"> Echtzeit√ºberweisung (SEPA Instant)</label>
        <label class="pay-opt"><input type="radio" name="pay" value="√úberweisung"> √úberweisung (IBAN)</label>
        <label class="pay-opt"><input type="radio" name="pay" value="Bar"> Barzahlung</label>
      </div>

      <!-- Method-specific panels -->
      <div id="panel-paypal" class="pay-panel">
        <div class="kv">
          <b>Betrag:</b> <span id="ppAmount">‚Äî ‚Ç¨</span>
          <b>PayPal:</b> <span><button type="button" class="copyBtn" id="ppGo">Zur PayPal-Zahlung</button></span>
        </div>
        <div id="paypalButtons" style="margin-top:10px;display:none"></div>
        <small class="muted">Not: PayPal.me linki veya PayPal Smart Buttons kullanƒ±labilir (CONFIG‚Äôe g√∂re).</small>
      </div>

      <div id="panel-stripe-card" class="pay-panel">
        <div class="kv">
          <b>Betrag:</b> <span id="stAmount">‚Äî ‚Ç¨</span>
          <b>Karte/Apple Pay:</b> <span><button type="button" class="copyBtn" id="stGo">Stripe Payment Link</button></span>
        </div>
        <small class="muted">Not: Stripe Payment Link‚Äôte Apple Pay destekli cihazlarda otomatik g√∂r√ºn√ºr.</small>
      </div>

      <div id="panel-sepa" class="pay-panel">
        <div class="kv">
          <b>Empf√§nger:</b> <span id="accName">‚Äî</span>
          <b>IBAN:</b> <span><span id="accIban" class="code">‚Äî</span> <button type="button" class="copyBtn" id="copyIban">Kopyala</button></span>
          <b>BIC:</b> <span id="accBic" class="code">‚Äî</span>
          <b>Betrag:</b> <span id="accAmt">‚Äî ‚Ç¨</span>
          <b>Verwendungszweck:</b> <span id="accRef" class="code">‚Äî</span>
        </div>
        <div class="qrWrap" style="margin-top:8px">
          <canvas id="epcQR" width="160" height="160" style="background:#fff;border-radius:8px"></canvas>
          <div class="muted">Mit Banking-App scannen (EPC QR). Echtzeit√ºberweisung wird unterst√ºtzt.</div>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <button class="btn" id="sendInquiry">Anfrage senden (WhatsApp)</button>
        <button class="btn gold" id="confirmBook">Buchung best√§tigen</button>
      </div>
      <small class="muted">Hinweis: Zahlungslink oder Kartenterminal-Optionen werden nach Best√§tigung bereitgestellt.</small>
    </form>
  </div>
</div>

<script>
/* ===== CONFIG (f√ºllen) ===== */
const CONFIG = {
  // --- PayPal ---
  paypalMe: "",           // √∂rn: "https://paypal.me/zentyexpress"  (opsiyonel, miktarƒ± ekleyeceƒüiz)
  paypalClientId: "",     // Smart Buttons istiyorsan PayPal client-id (opsiyonel). Bo≈üsa buton g√∂sterilmez.

  // --- Stripe Payment Links --- (√∂deme linkleri)
  stripeCardLink: "",     // Kart/Apple Pay i√ßin Payment Link (miktarƒ± m√º≈üteri belirleyebilir ≈üekilde ayarlayabilirsin)
  stripeApplePayLink: "", // ƒ∞stersen ayrƒ± link; bo≈üsa stripeCardLink kullanƒ±lƒ±r.

  // --- Banka hesabƒ± (SEPA/Echtzeit√ºberweisung/√úberweisung) ---
  merchant: {
    name: "Zenty Express AI",
    iban: "DE00 0000 0000 0000 0000 00",
    bic:  "ABCDEFGHXXX",
    city: "Lonsee",
    currency: "EUR"
  }
};
/* =========================== */

/* Starfield */
(function(){
  const canvas = document.getElementById('starfield');
  const ctx = canvas.getContext('2d');
  let W,H,stars=[];
  function resize(){W=canvas.width=canvas.clientWidth;H=canvas.height=canvas.clientHeight}
  window.addEventListener('resize',resize); resize();
  function init(){
    stars = Array.from({length:160}, _=> ({x:Math.random()*W,y:Math.random()*H,z:Math.random()*1.2+0.2,vx:(Math.random()-.5)*0.2,vy:(Math.random()-.5)*0.2}));
  }
  init();
  (function draw(){
    ctx.clearRect(0,0,W,H);
    const grad = ctx.createRadialGradient(W*0.6, H*0.2, 0, W*0.6, H*0.2, Math.max(W,H));
    grad.addColorStop(0,'rgba(42,168,255,0.25)'); grad.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);
    ctx.strokeStyle='rgba(140,200,255,0.22)'; ctx.lineWidth=1;
    ctx.beginPath(); for(let i=0;i<8;i++){ ctx.moveTo(W*0.2+i*40%W,H*0.1+i*22%H); ctx.lineTo(W*0.5,H*0.55); } ctx.stroke();
    for(const s of stars){
      s.x+=s.vx; s.y+=s.vy; if(s.x<0) s.x=W; if(s.x>W) s.x=0; if(s.y<0) s.y=H; if(s.y>H) s.y=0;
      const r=0.6+s.z*1.4; ctx.fillStyle='rgba(200,230,255,.9)'; ctx.beginPath(); ctx.arc(s.x,s.y,r,0,6.283); ctx.fill();
    }
    ctx.shadowBlur=18; ctx.shadowColor='rgba(80,170,255,.7)';
    ctx.fillStyle='rgba(60,160,255,.3)'; ctx.beginPath(); ctx.arc(W*0.5,H*0.55,46,0,6.283); ctx.fill();
    ctx.shadowBlur=0;
    requestAnimationFrame(draw);
  })();
})();

/* Leaflet map + pricing + booking */
(function(){
  // City coordinates (approx) ‚Äî within ~50km of Lonsee
  const cities = {
    "Lonsee":[48.5259,9.9274],
    "Ulm":[48.4011,9.9876],
    "Neu-Ulm":[48.3927,10.0111],
    "Blaustein":[48.4177,9.9410],
    "Dornstadt":[48.4633,9.9553],
    "G√ºnzburg":[48.4553,10.2728],
    "Senden":[48.3286,10.0442],
    "Ehingen":[48.2829,9.7276],
    "Laupheim":[48.2289,9.8776],
    "Geislingen":[48.6255,9.8344],
    "Biberach":[48.1033,9.7900],
    "Langenau":[48.4975,10.1192],
    "Wei√üenhorn":[48.3014,10.1582]
  };

  // datalist fill
  const dl = document.getElementById('citylist');
  Object.keys(cities).forEach(n => { const o=document.createElement('option'); o.value=n; dl.appendChild(o); });

  // Map init
  const start = cities["Lonsee"];
  const map = L.map('map',{zoomControl:false, attributionControl:false}).setView(start, 10);
  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19});
  const sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {maxZoom:19});
  osm.addTo(map);
  L.control.zoom({position:'bottomright'}).addTo(map);
  L.control.layers({"Harita":osm,"Sat":sat},null,{position:'topright'}).addTo(map);

  // Markers
  const markers = {};
  Object.entries(cities).forEach(([name,latlng])=>{
    const m = L.circleMarker(latlng,{radius:6,color:'#7fc1ff',fillColor:'#2aa8ff',fillOpacity:.9,weight:2})
      .addTo(map).bindTooltip(name,{direction:'top',offset:[0,-6],opacity:.9});
    m.on('click',()=>{ document.getElementById('destInput').value=name; compute(); });
    markers[name]=m;
  });

  // Polyline for route (dashed)
  let route = L.polyline([], {color:'#9ad0ff',weight:3,opacity:1,dashArray:'6 6'}).addTo(map);

  // Haversine
  function haversine(a,b){
    const toRad=d=>d*Math.PI/180; const R=6371;
    const dLat=toRad(b[0]-a[0]), dLon=toRad(b[1]-a[1]);
    const lat1=toRad(a[0]), lat2=toRad(b[0]);
    const h=Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
    return 2*R*Math.asin(Math.sqrt(h));
  }
  const priceTiers=[{max:20,rate:1.00},{max:100,rate:0.90},{max:9999,rate:0.80}];
  function priceFor(km){const t=priceTiers.find(x=>km<=x.max);return {rate:t.rate,total:km*t.rate};}

  const startInput=document.getElementById('startInput');
  const destInput=document.getElementById('destInput');
  const priceBox=document.getElementById('priceBox');
  const calcBtn=document.getElementById('calcBtn');
  const bookBtn=document.getElementById('bookBtn');
  const waBtn=document.getElementById('waBtn');
  const modal=document.getElementById('payModal');
  const closeModal=document.getElementById('closeModal');
  const sendInquiry=document.getElementById('sendInquiry');
  const confirmBook=document.getElementById('confirmBook');
  const payForm=document.getElementById('payForm');

  // Panels
  const panelPayPal = document.getElementById('panel-paypal');
  const panelStripe = document.getElementById('panel-stripe-card');
  const panelSEPA = document.getElementById('panel-sepa');

  // PayPal buttons container
  const paypalButtonsDiv = document.getElementById('paypalButtons');

  // Stripe / PayPal triggers
  const ppGo = document.getElementById('ppGo');
  const stGo = document.getElementById('stGo');

  // SEPA fields
  const accName = document.getElementById('accName');
  const accIban = document.getElementById('accIban');
  const accBic = document.getElementById('accBic');
  const accAmt = document.getElementById('accAmt');
  const accRef = document.getElementById('accRef');
  const copyIbanBtn = document.getElementById('copyIban');
  const epcQR = document.getElementById('epcQR');

  // Amount displays
  const ppAmount = document.getElementById('ppAmount');
  const stAmount = document.getElementById('stAmount');

  let currentTrip = {sName:null,dName:null,km:null,price:null,rate:null, amountNum:0};

  function compute(){
    const sName=startInput.value.trim(); const dName=destInput.value.trim();
    if(!cities[sName] || !cities[dName]){ priceBox.textContent='Entfernung: ‚Äî km ¬∑ Preis: ‚Äî'; route.setLatLngs([]); bookBtn.disabled=true; return;}
    const A=cities[sName], B=cities[dName];
    // Draw nice curve
    const mid=[(A[0]+B[0])/2,(A[1]+B[1])/2];
    const dx=B[1]-A[1], dy=B[0]-A[0];
    const len=Math.sqrt(dx*dx+dy*dy);
    const nx=-dy/len, ny=dx/len;
    const amp=Math.min(0.12,Math.max(0.04,len*0.25));
    const ctrl=[mid[0]+ny*amp, mid[1]+nx*amp];
    function quad(p0,p1,p2,t){const u=1-t;return [u*u*p0[0]+2*u*t*p1[0]+t*t*p2[0], u*u*p0[1]+2*u*t*p1[1]+t*t*p2[1]];}
    const pts=[]; for(let t=0;t<=1.001;t+=0.05) pts.push(quad(A,ctrl,B,t));
    route.setLatLngs(pts);
    map.fitBounds(L.latLngBounds([A,B]).pad(0.25));

    const km=haversine(A,B);
    const {rate,total}=priceFor(km);
    const dk=km.toFixed(1).replace('.',',');
    const ct=total.toFixed(2).replace('.',',');
    priceBox.innerHTML=`Route: <b>${sName}</b> ‚Üí <b>${dName}</b> ¬∑ Entfernung: <b>${dk} km</b> ¬∑ Preis (ab): <b>${ct} ‚Ç¨</b> <small class="muted">(Tarif ${rate.toFixed(2)} ‚Ç¨/km)</small>`;
    bookBtn.disabled=false;

    currentTrip = {sName,dName,km:dk,price:ct,rate:rate.toFixed(2), amountNum: parseFloat(total.toFixed(2))};
    waBtn.href = `https://api.whatsapp.com/send?phone=49162575957&text=${encodeURIComponent('Hallo! Anfrage: '+sName+' ‚Üí '+dName+' ('+dk+' km, ab '+ct+' ‚Ç¨)')}`;
  }

  calcBtn.addEventListener('click', compute);
  startInput.value='Lonsee';

  // Booking modal
  function openModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); }
  function close(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }
  closeModal.addEventListener('click', close);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) close(); });

  bookBtn.addEventListener('click', ()=>{
    if(!currentTrip.sName || !currentTrip.dName){ return; }
    openModal();
    ppAmount.textContent = currentTrip.price + " ‚Ç¨";
    stAmount.textContent = currentTrip.price + " ‚Ç¨";
    // reset panels
    [panelPayPal,panelStripe,panelSEPA].forEach(p=>p.classList.remove('show'));
  });

  function selectedPay(){
    const el = payForm.querySelector('input[name="pay"]:checked');
    return el ? el.value : null;
  }

  // Panel switching
  payForm.addEventListener('change', (e)=>{
    const method = selectedPay();
    [panelPayPal,panelStripe,panelSEPA].forEach(p=>p.classList.remove('show'));
    if(method==="PayPal"){ panelPayPal.classList.add('show'); initPayPal(); }
    if(method==="Kreditkarte" || method==="Apple Pay"){ panelStripe.classList.add('show'); }
    if(method==="Echtzeit√ºberweisung" || method==="√úberweisung"){ panelSEPA.classList.add('show'); fillSEPA(); }
  });

  // PayPal
  function initPayPal(){
    paypalButtonsDiv.style.display = "none";
    if(CONFIG.paypalClientId){
      // Load SDK once
      if(!document.getElementById('pp-sdk')){
        const s = document.createElement('script');
        s.id = 'pp-sdk';
        s.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(CONFIG.paypalClientId)}&currency=EUR`;
        s.onload = renderPP;
        document.body.appendChild(s);
      } else {
        renderPP();
      }
    }
  }
  function renderPP(){
    if(!window.paypal) return;
    paypalButtonsDiv.style.display = "block";
    paypalButtonsDiv.innerHTML = "";
    window.paypal.Buttons({
      style:{shape:"pill", layout:"horizontal", color:"gold", label:"paypal"},
      createOrder: (data, actions)=> actions.order.create({
        purchase_units:[{amount:{currency_code:"EUR", value: currentTrip.amountNum.toFixed(2)}},
        ]
      }),
      onApprove: (data, actions)=> actions.order.capture().then(function(details){
        alert("PayPal Zahlung erfolgreich: " + details.status);
        close();
      }),
      onError: (err)=> { console.error(err); alert("PayPal Fehler: "+err); }
    }).render('#paypalButtons');
  }

  ppGo.addEventListener('click', ()=>{
    if(CONFIG.paypalMe){
      const amt = currentTrip.amountNum.toFixed(2);
      const url = CONFIG.paypalMe.replace(/\/$/,'') + "/" + encodeURIComponent(amt);
      window.open(url, "_blank");
    } else {
      alert("PayPal.me linki CONFIG.paypalMe alanƒ±na ekleyiniz veya client-id ile Smart Buttons kullanƒ±n.");
    }
  });

  // Stripe Payment Link
  stGo.addEventListener('click', ()=>{
    const link = (selectedPay()==="Apple Pay" && CONFIG.stripeApplePayLink) ? CONFIG.stripeApplePayLink : CONFIG.stripeCardLink;
    if(link){
      window.open(link, "_blank");
    } else {
      alert("Stripe Payment Link URL'sini CONFIG.stripeCardLink alanƒ±na ekleyiniz.");
    }
  });

  // SEPA (EPC QR)
  function fillSEPA(){
    accName.textContent = CONFIG.merchant.name;
    accIban.textContent = CONFIG.merchant.iban;
    accBic.textContent = CONFIG.merchant.bic;
    accAmt.textContent = currentTrip.price + " ‚Ç¨";
    const ref = makeRef();
    accRef.textContent = ref;

    const epc = buildEPC({
      name: CONFIG.merchant.name,
      iban: CONFIG.merchant.iban.replace(/\s+/g,''),
      bic: CONFIG.merchant.bic,
      amount: currentTrip.amountNum.toFixed(2),
      remittance: ref
    });
    // draw QR
    QRCode.toCanvas(epcQR, epc, {width:160, errorCorrectionLevel:"M"}, function (error) {
      if (error) console.error(error);
    });
  }

  function makeRef(){
    const dt = new Date();
    const y = dt.getFullYear();
    const m = String(dt.getMonth()+1).padStart(2,'0');
    const d = String(dt.getDate()).padStart(2,'0');
    const code = `ZENTY-${y}${m}${d}-${currentTrip.sName}-${currentTrip.dName}-${currentTrip.km}km`;
    return code.replace(/[^A-Z0-9\-]/gi,'-').slice(0,70);
  }

  function buildEPC({name, iban, bic, amount, remittance}){
    // EPC069-12 format (SCT)
    // Lines must be \n separated, no extra spaces.
    return [
      "BCD",
      "001",
      "1",
      "SCT",
      bic || "",
      name,
      iban,
      "EUR"+amount,
      "",     // Purpose
      remittance || "",
      ""      // Empty line at end per some apps (tolerated if missing)
    ].join("\n");
  }

  copyIbanBtn.addEventListener('click', ()=>{
    navigator.clipboard.writeText(CONFIG.merchant.iban).then(()=>{
      copyIbanBtn.textContent = "Kopyalandƒ± ‚úì"; setTimeout(()=>copyIbanBtn.textContent="Kopyala",1500);
    });
  });

  function buildMsg(prefix){
    const pay = selectedPay() || '‚Äî';
    const name = document.getElementById('custName').value.trim() || '‚Äî';
    const phone = document.getElementById('custPhone').value.trim() || '‚Äî';
    const when = document.getElementById('pickupTime').value || '‚Äî';
    const note = document.getElementById('note').value.trim() || '‚Äî';
    return `${prefix}
${currentTrip.sName} ‚Üí ${currentTrip.dName}
Entfernung: ${currentTrip.km} km
Preis (ab): ${currentTrip.price} ‚Ç¨ (Tarif ${currentTrip.rate} ‚Ç¨/km)
Zahlung: ${pay}
Name: ${name} ¬∑ Telefon: ${phone}
Abholung: ${when}
Notiz: ${note}`.trim();
  }

  sendInquiry.addEventListener('click', ()=>{
    if(!currentTrip.sName) return;
    const msg = buildMsg('Anfrage / Request:');
    window.open(`https://api.whatsapp.com/send?phone=49162575957&text=${encodeURIComponent(msg)}`,'_blank');
  });

  confirmBook.addEventListener('click', ()=>{
    if(!payForm.reportValidity()) return;
    const method = selectedPay();
    // Try to open the preferred payment if configured, else WhatsApp confirmation
    if(method==="PayPal"){
      if(CONFIG.paypalMe){ ppGo.click(); }
      else if(CONFIG.paypalClientId){ alert("PayPal Smart Buttons √ºzerinden devam edebilirsiniz."); }
      else { alert("PayPal yapƒ±landƒ±rƒ±lmadƒ±, WhatsApp ile teyit edelim."); }
    }
    if(method==="Kreditkarte" || method==="Apple Pay"){
      if(CONFIG.stripeCardLink || CONFIG.stripeApplePayLink){ stGo.click(); }
      else { alert("Stripe Payment Link ekleyiniz, ≈üu an WhatsApp ile teyit edelim."); }
    }
    if(method==="Echtzeit√ºberweisung" || method==="√úberweisung"){
      // QR zaten g√∂sterildi; kullanƒ±cƒ± bankasƒ±ndan √∂deyebilir.
      alert("Bankanƒ±zdan SEPA (Echtzeit) ile g√∂nderebilirsiniz. IBAN ve EPC QR hazƒ±r.");
    }
    const msg = buildMsg('Buchung ¬∑ Best√§tigung gew√ºnscht:');
    window.open(`https://api.whatsapp.com/send?phone=49162575957&text=${encodeURIComponent(msg)}`,'_blank');
    close();
  });
})();</script>
</body>
</html>
"""
out = Path("/mnt/data/index.html")
out.write_text(html, encoding="utf-8")
print(str(out))
